<div class="page-header">
  <div class="container-fluid">
    <h2 class="h5 no-margin-bottom">{{ each_access.formDesc }}</h2>
  </div>
</div>

<input type="hidden" id="opsgenieLabel" name="accessLabel" value="[]">
<div class="row">
  <div class="col-md-6">
    <div class="page-header">
      <div class="container-fluid">
        <h2 class="h5 no-margin-bottom">Opsgenie</h2>
      </div>
    </div>
    <div class="box box-danger">
      {% for permission, desc in each_access.accessRequestData.opsgenie.items %}
      <div class="form-check">
        <input class="form-check-input" type="checkbox" value="{{ desc }}" name="opsgenieRequest" id="defaultCheck1{{ desc }}">
        <label class="form-check-label" for="defaultCheck1{{ desc }}">
            {{ permission }}
        </label>
      </div>
      {% endfor %}
    </div>
  </div>
</div>

<div class='row'>
    <div class="col-sm-9">
      <label for="opsgenieteamadmin">
        &nbsp&nbsp&nbsp&nbsp<input class="form-check-input" type="checkbox" value="true" style="height: 20px;width: 20px;" onchange="isAdmin(this)"  name="opsgenieteamadmin" id="opsgenieteamadmin">&nbsp&nbspTeam Admin
      </label>
    </div>
</div>

<div class="row">
  <div class="col-md-6">
    <div class="form-group">
      <label class="col-sm-3" for="reason" style="padding-left:15px; font-weight: bolder; min-height:0px; margin-top:10px; font-size:medium;">Reason for Access:</label>
      <input type="text" class="form-text1" id="reason" name="accessReason" style="width:60%;" maxlength="2024" required>
    </div>
  </div>
</div>


<script type="text/javascript">


function isAdmin(opsgenieteamadmin) {
    labelComponents = JSON.parse($('#opsgenieLabel').val());
    if(!labelComponents.length){
      labelComponents = [{}]
    }
    labelComponents[0]["UserType"] = opsgenieteamadmin.checked ? "team_admin" : "user";
    $('#opsgenieLabel').val(JSON.stringify(labelComponents));
  }
  function registerLabelChange() {
    var finalSelectedLabels = [];
    var allAccess = $('[name=opsgenieRequest]'); // multiple elements with same id
    teams_list = []
    for(var iter = 0; iter < allAccess.length; iter += 1) {
      if(allAccess[iter].checked) {
        teams_list.push(allAccess[iter].value);
      }
    }
    user_type = "user"
    labelComponents = JSON.parse($('#opsgenieLabel').val());
    if(!labelComponents.length){
      labelComponents = [{}]
    }
    
    if("UserType" in labelComponents[0]) {
      user_type = labelComponents[0]["UserType"]
    }
    
    finalSelectedLabels.push({"teams_list":teams_list,"UserType": user_type});
    $('#opsgenieLabel').val(JSON.stringify(finalSelectedLabels.sort()));
  }
  $('[name=opsgenieRequest]').change(function(changeData) {
    registerLabelChange();
  });


</script>
